<html>

<head>
    <title>Pelumoottori<SIC> </title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="glMatrix.js"        ></script>
<script type="text/javascript" src="webglutils.js"      ></script>

<script type="text/javascript" src="Renderer.js"        ></script>
<script type="text/javascript" src="Shaderlib.js"       ></script>
<script type="text/javascript" src="Inputs.js"          ></script>
<script type="text/javascript" src="Scene.js"           ></script>

<script type="text/javascript" src="Material.js"        ></script>
<script type="text/javascript" src="Texture.js"         ></script>

<script type="text/javascript" src="Buffer.js"          ></script>
<script type="text/javascript" src="Mesh.js"            ></script>
<script type="text/javascript" src="Entity.js"          ></script>
<script type="text/javascript" src="Camera.js"          ></script>
<script type="text/javascript" src="HUD_Item.js"        ></script>
<script type="text/javascript" src="parser/Importer.js" ></script>

<script type="text/javascript" src="testCube.js"        ></script>

   
   
<script id="pixel_Shader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 vTextureCoord;

    uniform sampler2D uSampler;

    void main(void) 
    {
        gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
    }
</script>




<script id="vertex_Shader" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;
    
    void main(void) 
    {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }
</script>









<script id="HAX_VS" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;
    
    void main(void) 
    {
        gl_Position   = uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }
</script>

// [255,0,255] -> Chroma key
// gl_FragColor = vec4(texel_Color.rgb , texel_Color.a * 1.0);
       


<script id="HAX_PS" type="x-shader/x-fragment">
    precision mediump           float;
    varying vec2        vTextureCoord;
    uniform sampler2D        uSampler;
  
    
    void main(void) 
    {
        vec4 texel = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
      
        if( texel.r == 1.0 && texel.g == 0.0 && texel.b == 1.0 ) discard;       
        
        gl_FragColor = texel;
    }
</script>






<script type="text/javascript">

    var renderer   = null;    
    var myCamera   = null;
    var myScene    = null;
    var counter    =    0;
    var dir        =    1;
    

    
   var myCube;
   var mySphere;
      
      
    function tick() 
    {   
        requestAnimFrame(tick);
     
        myCube.yaw( 0.012 );
        myCube.roll ( 0.015 );
        
        mySphere.roll( 0.001   );
        mySphere.pitch( 0.002 );
          
        if( key_Down( 37 ) )   myCamera.yaw( 0.05  );
        if( key_Down( 39 ) )   myCamera.yaw( -0.05 );
          
        if( key_Down( 38 ) )   myCamera.forward( 0.5 );  
        if( key_Down( 40 ) )   myCamera.backward( 0.5 );
        
        if( key_Down( 33 ) )   myCamera.pitch( 0.008 );
        if( key_Down( 34 ) )   myCamera.pitch( -0.008 );
         
        myScene.render();
    }
    
    
    
    function Map_To_Screen( renderer , hPoint )
    {
       var w2 = renderer.target_Width  / 2;
       var h2 = renderer.target_Height / 2;
       var x  =  ( hPoint[0] - w2  )   / w2;
       var y  =  (  h2 - hPoint[1] )   / h2; 
       return [x,y,0];
    }
    
    
    
    function Start() 
    {  
        renderer         = new Renderer( document.getElementById("Canvas")                  );
        myCamera         = new   Camera( renderer, 0.1, 1000, 45                            );
       
        var myShader     = new  Shader( renderer.gl , "vertex_Shader", "pixel_Shader"       );
        var ortShader    = new  Shader( renderer.gl , "HAX_VS", "HAX_PS"                    );
        
        var myTexture    = new Texture( renderer.gl , "data/texture.png"   , "FILTER_FANCY" );  
        var crosshair    = new Texture( renderer.gl , "data/crosshair1.png", "FILTER_PLAIN" );
        var earthTex     = new Texture( renderer.gl , "data/earth.png"     , "FILTER_FANCY" );
        
        var myMaterial   = new Material( myShader , myTexture                               );               
        var guiMaterial  = new Material( ortShader, crosshair                               );
        var earthMat     = new Material( myShader , earthTex                                );
       
            myCube      = test_Cube     ( renderer.gl , myMaterial                          ); 
            mySphere    = test_Sphere   ( renderer.gl , earthMat                            );
            heh         = test_Rectangle( renderer.gl, guiMaterial , [0.08,0.08]            );
           
      var crosshairs    = [  test_Rectangle( renderer.gl, guiMaterial , [0.10,0.10] )  ];
        
             myCube.set_Position( [ 0,-1.5,-3 ]                                             );
           myCamera.set_Position( [ 0, 1.1, 0 ]                                             );
           mySphere.set_Position( [ 0, 1.0,-3 ]                                             );
       
        crosshairs[0].set_Position( Map_To_Screen( renderer, [300,300] )                    );                                                 // NOTE! In homogenous screen space! <  -1------+1 >
    
       
        document.onkeydown = kbDown_Event;
        document.onkeyup   = kbUp_Event; 
        
        myScene = new Scene( renderer         );
        myScene.insert( myCube, "DYNAMIC"     );
        myScene.insert( mySphere, "DYNAMIC"   );
      
        myScene.insert( crosshairs[0], "GUI"  );
        myScene.insert( myCamera     , "CAM"  );
        
        renderer.set_BgrColor( [0.0,0.0,0.0,1.0] );
        
      //  var worldMesh   = import_Mesh( renderer.gl , "data/object.obj");
     //   var worldEntity = new Entity( worldMesh, myMaterial );

    //    myScene.insert( worldEntity, "DYNAMIC" );
        
        
        
     //  var worldMesh   = import_Irmesh( renderer.gl, "data/XD.txt");
     //  var worldEntity = new Entity( worldMesh, myMaterial );
        
       //myScene.insert( worldEntity , "DYNAMIC" );
       
        var meshSet  = import_Irmesh( renderer.gl, "data/XD.txt");
        
        
        var e1 = new Entity( renderer.gl meshSet[0], myMaterial );
        var e2 = new Entity( rendere.gl, meshSet(1], myMaterial );
        
        
        myScene.insert( e1 , "DYNAMIC" );
        myScene.insert( e2 , "DYNAMIC" );
        
        
       tick();     
    }

    
</script>

</head>

<body onload="Start();">
   
    <canvas id="Canvas" style="border: none;" width="600" height="600"></canvas>

    <br/>  
</body>

</html>
