<html>

<head>
    <title>Pelumoottori<SIC> </title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="glMatrix.js"               ></script>
<script type="text/javascript" src="webglutils.js"             ></script>

<script type="text/javascript" src="Renderer.js"               ></script>
<script type="text/javascript" src="Shaderlib.js"              ></script>
<script type="text/javascript" src="Inputs.js"                 ></script>
<script type="text/javascript" src="Scene.js"                  ></script>

<script type="text/javascript" src="Material.js"               ></script>
<script type="text/javascript" src="Texture.js"                ></script>

<script type="text/javascript" src="Buffer.js"                 ></script>
<script type="text/javascript" src="Mesh.js"                   ></script>

<script type="text/javascript" src="Entity.js"                 ></script>
<script type="text/javascript" src="Camera.js"                 ></script>
<script type="text/javascript" src="Guiobject.js"              ></script>
<script type="text/javascript" src="Color.js"                  ></script>
<script type="text/javascript" src="parser/Importer.js"        ></script>
<script type="text/javascript" src="parser/parser_Geometry.js" ></script>
<script type="text/javascript" src="parser/Filereader.js"      ></script>


<script type="text/javascript" src="math/Vector3.js"           ></script>
<script type="text/javascript" src="math/Matrix33.js"          ></script>
<script type="text/javascript" src="math/Matrix44.js"          ></script>
<script type="text/javascript" src="math/MatrixGL.js"          ></script>
<script type="text/javascript" src="math/Orientation.js"       ></script>



<script type="text/javascript" src="Assetmanager.js"           ></script>
<script type="text/javascript" src="misc/Process.js"           ></script>
<script type="text/javascript" src="testCube.js"               ></script>

   
   
<script id="pixel_Shader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 vTextureCoord;
    uniform sampler2D uSampler;

    void main(void) 
    {
        gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
    }
</script>


<script id="vertex_Shader" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;
    
    void main(void) 
    {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }
</script>



<script id="HAX_VS" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;
    
    void main(void) 
    {
        gl_Position   = uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }
</script>



<script id="HAX_PS" type="x-shader/x-fragment">
    precision mediump           float;
    varying vec2        vTextureCoord;
    uniform sampler2D        uSampler;
  
    
    void main(void) 
    {
        vec4 texel = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
      
        if( texel.r == 1.0 && texel.g == 0.0 && texel.b == 1.0 ) discard;       
        
        gl_FragColor =  texel;
    }
</script>




<script id="COLOR_PS" type="x-shader/x-fragment">
    
    precision mediump           float;
    varying vec2        vTextureCoord;
    uniform sampler2D        uSampler;
    
    uniform  vec4              vColor;

    
    void main(void) 
    {
        vec4 texel = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
      
        if( texel.r == 1.0 && texel.g == 0.0 && texel.b == 1.0 )
        {
            discard;
        }       
        
    
        gl_FragColor = vec4( (vColor.r+texel.r)/ 2.0 ,
                             (vColor.g+texel.g)/ 2.0 , 
                             (vColor.b+texel.b)/ 2.0 ,
                                                 1.0 ) ;//vColor;
    }
</script>







<script type="text/javascript">

    var renderer   = null;    
    var myCamera   = null;
    var myScene    = null;
    
      
    function tick() 
    {   
        requestAnimFrame(tick);
     
          
          if( key_Down( 37 ) )   myCamera.yaw( -0.05  );
          if( key_Down( 39 ) )   myCamera.yaw(  0.05 );
          
          if( key_Down( 38 ) )   myCamera.forward(  1.0 );  
          if( key_Down( 40 ) )   myCamera.backward( 1.0 );
        

          if( key_Down( 33 ) )   myCamera.move([0,1,0]);
          if( key_Down( 34 ) )   myCamera.move([0,-1,0]);
         
         
         
         if(  key_Down( 87 ) )   myCamera.pitch( 0.008 );        // W to pitch up
         if(  key_Down( 83 ) )   myCamera.pitch( -0.008 );      // S to pitch down
         
         if(  key_Down( 81 ) )   myCamera.roll( 0.008 );       // Q to roll left
         if(  key_Down( 69 ) )   myCamera.roll( -0.008 );      // E to roll right
         
          myScene.render();
    }
    
       
    function Map_To_Screen( renderer , hPoint )
    {
       var w2 = renderer.target_Width  / 2;
       var h2 = renderer.target_Height / 2;
       var x  =  ( hPoint[0] - w2  )   / w2;
       var y  =  (  h2 - hPoint[1] )   / h2; 
       return [x,y,0];
    }
    
       
    function register_Inputs()
    {
        document.onkeydown = kbDown_Event;
        document.onkeyup   = kbUp_Event; 
    }
       
       
        
    function Start() 
    {  
      
       
        var canvas          = document.getElementById("Canvas");
   
        
        canvas.style.width  = window.innerWidth;
        canvas.style.height = window.innerHeight -5;  // HÄKSÄN HÄÄ!         
         
        renderer            = new Renderer( canvas                         );
        renderer.set_BgrColor( [0.0,0.0,0.0,1.0]                           );
        
        myCamera            = new   Camera( renderer, 0.1, 1000, 65        );
        myCamera.set_Position(  [-2.750824,0.444516,-24.011581] );
        
        register_Inputs();      // Erillinen luokka tälle!
       
        var assman          = new Assetmanager( renderer);
        
        myScene             = import_Scene( renderer, "data/TestLevel/Test.irr", assman );
       
                           //   ( renderer, material, dimensions, tint  )
        var X1 = new Guiobject( renderer , assman, "data/crosshair1.png", ["HAX_VS","COLOR_PS"] , [ 0.1 , 0.1 ], new Color(1,1,1) );
        // t( renderer, assman, texRef, shaderRef, dimensions, tint  )
         
        
       
        myScene = new Scene( renderer             );
      //  myScene.insert(X1, "GUI" );
        myScene.insert( myCamera      , "CAM"       );
        
   
    tick();     
    }

    
</script>




</head>



<body onload="Start();">
   
    <canvas id="Canvas" style="border: none;" width="1200" height="800"></canvas>

    <br/>  
</body>

</html>


/*
function Start() 
    {  
        var canvas          = document.getElementById("Canvas");
        
        canvas.style.width  = window.innerWidth;
        canvas.style.height = window.innerHeight -5;  // HÄKSÄN HÄÄ!         
         
        renderer            = new Renderer( canvas                         );
        renderer.set_BgrColor( [0.0,0.0,0.0,1.0]                           );
        
        myCamera            = new   Camera( renderer, 0.1, 1000, 65        );
        myCamera.set_Position(  [-2.750824,0.444516,-24.011581] );
        
        register_Inputs();      // Erillinen luokka tälle!
       
        var assman          = new Assetmanager( renderer );
        myScene             =     import_Scene( renderer , "data/TestLevel/Test.irr", assman );
        var X1              = new    Guiobject( renderer , assman, "data/crosshair1.png", ["HAX_VS","COLOR_PS"] , [ 0.10 , 0.10 ], new Color(1,1,0)  );
     
        myScene.insert(X1, "GUI" );
       
   //     myScene = new Scene( renderer             );
    //  myScene.insert( cx            , "GUI"       );
        myScene.insert( myCamera      , "CAM"       );
        
   
    tick();     
    }
    */