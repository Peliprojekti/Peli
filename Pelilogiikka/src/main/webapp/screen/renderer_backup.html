
<html>

<head>
<title>Pelimoottori</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script src="http://localhost:1339/socket.io/socket.io.js">               </script>
<script src="/javascript/common/log.js">                                  </script>
<script src="/javascript/screen/screenComs.js">                            </script>

<script type="text/javascript" src="/javascript/rendering/glMatrix.js"     ></script>
<script type="text/javascript" src="/javascript/rendering/webglutils.js"   ></script>

<script type="text/javascript" src="/javascript/rendering/Renderer.js"     ></script>
<script type="text/javascript" src="/javascript/rendering/Shaderlib.js"    ></script>
<script type="text/javascript" src="/javascript/rendering/Inputs.js"       ></script>

<script type="text/javascript" src="/javascript/rendering/Material.js"     ></script>
<script type="text/javascript" src="/javascript/rendering/Texture.js"      ></script>

<script type="text/javascript" src="/javascript/rendering/Buffer.js"       ></script>
<script type="text/javascript" src="/javascript/rendering/Mesh.js"         ></script>
<script type="text/javascript" src="/javascript/rendering/Entity.js"       ></script>
<script type="text/javascript" src="/javascript/rendering/Camera.js"       ></script>
<script type="text/javascript" src="/javascript/rendering/testCube.js"     ></script>
<script type="text/javascript" src="/javascript/rendering/HUD_Item.js"     ></script>





<script id="pixel_Shader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 vTextureCoord;

    uniform sampler2D uSampler;

    void main(void) 
    {
        gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
    }
</script>


<script id="vertex_Shader" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;
    
    void main(void) 
    {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }
</script>





<script type="text/javascript">

   
    var myCube       = null;
    var myCrosshair  = null;
    var mySphere     = null;
    var renderer     = null;    
    var myCamera     = null;
    var myScene      = null;
      

    
    
    function tick() 
    {
        requestAnimFrame(tick);
     
        myCube.yaw( 0.012 );
        myCube.roll ( 0.015 );
        
        mySphere.roll( 0.001   );
        mySphere.pitch( 0.002 );
         
        myScene.render();
     }
    
    
    
    function Connection( address )
    {
        this.socket = io.connect( address );

	this.socket.on('message', function(data) 
        {
            myEntity.set_Position( [data.xCoordinate/100, data.yCoordinate/100, -15] );             
        });   
    };
    
    
    
    
    function Start() 
    {
        renderer         = new Renderer( document.getElementById("Canvas")             );
        myCamera         = new   Camera(                                               );
       
        var myShader     = new  Shader( renderer.gl , "vertex_Shader", "pixel_Shader"  );
        var ortShader    = new  Shader( renderer.gl , "HAX_VS", "HAX_PS"               );
        
        var myTexture    = new Texture( renderer.gl , "/data/texture.png"               );  
        var crosshair    = new Texture( renderer.gl , "/data/crosshair1.png"            );
        var earthTex     = new Texture( renderer.gl , "/data/earth.png"                 );
        
        var myMaterial   = new Material( myShader , myTexture                          );               
        var guiMaterial  = new Material( ortShader, crosshair                          );
        var earthMat     = new Material( myShader , earthTex                           );
       
            myCube      = test_Cube     ( renderer.gl , myMaterial                     ); 
            mySphere    = test_Sphere   ( renderer.gl , earthMat                       );
           
        var crosshairs    = [  test_Rectangle( renderer.gl, guiMaterial , [0.08,0.08] ) ,
                               test_Rectangle( renderer.gl, guiMaterial , [0.04,0.04] ) ,
                               test_Rectangle( renderer.gl, guiMaterial , [0.16,0.16] )  ];
      
             myCube.set_Position( [ 0,-1.5,-3 ]                                        );
           myCamera.set_Position( [ 0, 1.1, 0 ]                                        );
           mySphere.set_Position( [ 0, 1.0,-3 ]                                        );
       
           
       crosshairs[0].set_Position( Map_To_Screen( renderer, [300,400] )                );                                                 // NOTE! In homogenous screen space! <  -1------+1 >
       crosshairs[1].set_Position( Map_To_Screen( renderer, [100,200] )                );                                                 // NOTE! In homogenous screen space! <  -1------+1 >
       crosshairs[2].set_Position( Map_To_Screen( renderer, [400,500] )                );                                                 // NOTE! In homogenous screen space! <  -1------+1 >
       
       
        document.onkeydown = kbDown_Event;
        document.onkeyup   = kbUp_Event; 
        
        myScene = new Scene( renderer );
        myScene.insert( myCube, "DYNAMIC"   );
        myScene.insert( mySphere, "DYNAMIC" );
      
        myScene.insert( crosshairs[0], "GUI"  );
        myScene.insert( crosshairs[1], "GUI"  );
        myScene.insert( crosshairs[2], "GUI"  );
        
        myScene.insert( myCamera    , "CAM"  );
        
        renderer.set_BgrColor( [0.0,0.0,0.0,1.0] );
       
        var connection = new Connection( 'http://localhost:1339' );
        
        tick();     
    }


</script>


</head>


<body onload="Start();">
   
    <canvas id="Canvas" style="border: none;" width="1024" height="768"></canvas>

    <br/>
  
</body>

</html>
